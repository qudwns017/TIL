# Process & Thread

## Process
* 컴퓨터에서 실행되고 있는 프로그램을 말하며 CPU 스케줄링의 대상이 되는 작업이라는 용어와 같은 의미로 사용된다.

* **프로그램**이 메모리에 적재되면 인스턴스화 되며 **프로세스**가 되고, 운영체제의 CPU 스케줄링에 따라 CPU가 프로세스를 실행한다.
  
## 프로세스와 컴파일 과정
* 프로그램은 컴파일러가 컴파일 과정을 거쳐 컴퓨터가 이해할 수 있는 기계어로 번역되어 실행될 수 있는 파일이 되는 것을 의미한다.

## 컴파일 과정
1. 전처리 : 소스 코드 파일의 주석을 제거하고 헤더 파일을 병합하여 매크로를 치환
2. 컴파일러 : 오류 처리, 코드 최적화 작업을 하며 어셈블리어로 변환
3. 어셈블러 : 컴파일러가 변환한 어셈블리어를 목적 코드로 변환
4. 링커 : 프로그램 내에 있는 라이브러리 함수 또는 다른 파일들과 목적 코드를 결합하여 실행 파일을 생성
* 정적 라이브러리 : 프로그램 빌드 시 라이브러리가 제공하는 모든 코드를 실행 파일에 넣는 방식, 외부 의존도가 낮지만 코드 중복과 같은 메모리 효율성이 떨어지는 단점 존재
* 동적 라이브러리 : 프로그램 실행 시 필요할 때만 DDL이라는 함수 정보를 통해 참조, 외부 의존도가 높지만 메모리 효율성 방면에서 유리

## 프로세스의 상태 (생준실대완)
* 생성 상태 : 프로세스가 생성된 상태, fork() / exec()
* 준비 상태 : 실행 가능한 상태지만 CPU 스케줄러로부터 CPU 소유권이 넘어오기를 기다리는 상태
* 실행 상태 : CPU 소유권과 메모리를 할당받고 실행 중인 상태
* 대기 상태 : 입출력장치에 의한 인터럽트로 프로세스가 차단 된 상태
* 완료(종료) 상태 : 메모리와 CPU 소유권을 모두 반환하는 상태. 부모 프로세스 또는 사용자에 의해 프로세스를 종료할 때 발생

## 프로세스의 메모리 구조
![image](https://github.com/qudwns017/TIL/assets/82150958/68450d07-c2a3-4d6f-a4f1-e18bec5804bf)
* 스택
  *  지역변수, 매개변수, 함수와 같이 동적으로 크기가 변하는 값들이 컴파일 시 저장됨
  *  힙과 스택의 메모리 영역이 겹치면 안되기 때문에 힙과 스택 사이의 공간은 비워놓는다.(오름차순)
*  힙
   *  프로그래머가 직접 할당하는 동적인 값들을 런타임 시 저장
   *  내림차순으로 주솟값 할당
*  데이터 영역
   *  프로그램이 실행되는 동안 전역변수, 정적변수와 같은 유지해야하는 데이터를 저장
   *  프로그램이 종료되면 사라지는 변수를 저장
*  코드 영역
   *  수정이 불가능한 기계어로 저장되어 있음
   *  코드 명령어들이 저장 되어 있음
  
## PCB
* 프로세스에 대한 메타데이터를 저장한 데이터
* 프로세스와 관련된 정보를 저장

* 컨텍스트 스위칭(문맥 교환)
  * PCB를 교환하는 과정을 의미
  * 프로세스에 할당된 시간이 끝나거나 타이머 인터럽트에 의해 발생
  1. 프로세스 A의 실행 시간이 끝나면 프로세스 A의 PCB를 저장 후 유휴 시간이 끝나면 프로세스 B의 PCB를 로드 후 B 실행
  2. 프로세스 B의 실행 시간이 끝나면 프로세스 B의 PCB를 저장 후 프로세스 A의 PCB를 로드 후 프로세스 A를 실행
  * 컨텍스트 스위칭이 일어날 때 유휴 시간이 발생하는데, 이 유휴 시간 때문에 컨텍스트 스위칭이 자주 일어날 수록 비용은 증가하게 된다. 이를 캐시 미스라고 칭한다.
  
## 멀티프로세싱
* 여러 개의 프로세스, 즉 멀티프로세스를 통해 동시에 두 가지 이상의 일을 수행할 수 있는 것
* 프로세스 중 일부에 문제가 발생되더라도 다른 프로세스를 이용해서 처리할 수 있으므로 신뢰성이 높다는 장점
* IPC(Inter Process Communication)
  * 프로세스끼리 데이터를 주고받고, 공유 데이터를 관리하는 메커니즘
  * ex : 클라이언트는 데이터를 요청하고 서버는 클라이언트 요청에 응답하는 구조
  * IPC의 종류
    * 공유 메모리
    * 파일
    * 소켓
    * 익명 파이프
    * 명명 파이프
    * 메시지 큐
  * 프로세스의 메모리를 완전 공유하는 스레드보다는 속도가 떨어진다는 단점
## 스레드와 멀티스레딩
### 스레드
* 프로세스의 실행 가는한 가장 작은 흐름의 단위
* 프로세스는 여러 개의 스레드를 가질 수 있다.
* 코드, 데이터, 힙 영역은 서로 공유하고, 고유한 스택 영역만 각각 가지고 있다.
### 멀티스레딩
* 프로세스 내 작업을 여러 개의 스레드, 즉 멀티 스레드로 처리하는 기법
* 스레드끼리 자원을 공유하는 특성 때문에 효율성이 높다.
* 예를 들어 웹 요청을 처리할 때, 새 프로세스를 생성하는 대신 스레드를 사용하는 웹 서버의 경우 훨씬 적은 리소스를 소비
* 한 스레드가 중단되어도 다른 스레드는 실행 상태일 수 있기 때문에 중단되지 않는 빠른 처리의 장점
* 하지만 한 스레드에 문제가 생기면 다른 스레드에도 영향을 끼쳐 프로세스에까지도 영향을 줄 수 있는 단점

## 교착 상태
* 두 개 이상의 프로세스들이 CPU 자원 선점을 위해 중단된 상태를 의미한다.
### 교착 상태의 원인
* 상호 배제 : 한 프로세스가 자원을 독점하고 있으며 다른 프로세스들은 접근이 불가능
* 점유 대기 : 특정 프로세스가 점유한 자원을 다른 프로세스가 요청
* 비선점 : 다른 프로세스의 자원을 강제적으로 가져올 수 없는 것
* 환형 대기 : A가 B의 자원을 요구하고, B는 A의 자원을 요구하는 등 서로가 서로의 자원을 요구하는 상황
### 교착 상태의 해결 방법
* 자원 할당 시 애초에 **조건이 성립하지 않게 설계**
* 교착 상태의 가능성이 없을 때만 자원 할당되며, 프로세스당 요청할 자원들의 최대치를 통해 자원 할당 가능 여부를 파악하는 **은행원 알고리즘** 사용
* 교착 상태의 원인을 분석하고 이에 관련된 프로세스 종료
* 교착 상태는 매우 드물게 일어나기에 이를 처리하는 비용이 더 커서 사용자가 작업을 종료하는 방법 선택, 현대 알고리즘은 이를 선택(응답 없음 창과 같은 개념)