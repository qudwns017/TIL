# Transaction
- 데이터 무결성을 지킴으로써 데이터베이스를 일관된 상태를 유지하기 위한 핵심적인 개념
- DB의 상태를 변경시키기 위해 수행하는 작업 단위를 의미함

## 구성
- 하나 이상의 read operation
- 하나 이상의 write operation
- 트랜잭션 안에서의 데이터 계산 operation

## 트랜잭션의 특성(ACID)
### 원자성(Atomicity)
- 트랜잭션 안의 모든 작업(operation)이 실행되거나 모두 실패
### 일관성(Consistency)
- 트랜잭션의 실행이 데이터베이스의 무결성을 유지
### 격리성(Isolation)
- 동시에 실행되는 트랜잭션은 서로 독립적이거나 순차적으로 실행
### 영속성(Durability)
- 성공적으로 수행된 트랜잭션은 영원히 반영되어야 함

## 트랜잭션의 상태
![image](https://github.com/qudwns017/TIL/assets/82150958/f8f6ead8-0fc4-4714-a8b5-d5364c5b6ecc)

## 트랜잭션 스케줄
- 데이터베이스의 일관된 상태를 유지하기 위해 동시에 실행되는 트랜잭션 작업의 순서를 정하는 것

## 트랜잭션 회복
- 트랜잭션 수행 중 장애로 인해 손상된 DB를 이전 상태로 복구시키는 작업
### 회복 연산
- Dump(덤프) : DB 전체를 다른 저장장치에 주기적으로 복사
- Log(로그) : DB의 내용이 갱신될 때마다 데이터 갱신의 이전 값과 이후 값을 별도의 파일에 기록
- Redo(재실행) : DB의 복사본을 가져와 로그를 이용해 장애 발생 직전의 DB 상태로 복구(트랜잭션 완료 전에 장애가 발생한 경우)
- Undo(취소) : 로그를 이용해 실행된 연산을 취소해 DB의 원래 상태로 복구하는 연산(트랜잭션 완료 이후에 장애가 발생한 경우)

### 로그 회복 기법
- 로그 회복 기법
  - 즉시 갱신 회복 기법 : 트랜잭션 수행 중 데이터를 변경한 연산의 결과를 데이터베이스에 즉시 반영하는 경우
  - 지연 갱신 회복 기법 : 트랜잭션이 수행되는 동안에는 데이터 변경 연산의 결과를 데이터베이스에 즉시 반영하지 않고 로그 파일에 기록해두었다가, 트랜잭션이 커밋된 후, 로그의 내용을 기반으로 데이터베이스에 한 번에 반영

### 검사 시점(Checkpoint) 회복 기법
- 로그 회복 기법과 같은 방법으로 로그 기록을 이용하지만, 일정한 시간 간격으로 체크포인트를 만들어둔다. 이후 장애가 발생하면 체크포인트 이전의 트랜잭션에는 회복 작업을 수행하지 않고 이후의 트랜잭션에만 회복 작업을 진행
- 로그 회복 기법의 비효율성을 해결하기 위해 제안됨

### 미디어 회복 기법
- 미디어 회복 기법은 전체 데이터베이스의 내용을 일정한 주기마다 다른 안전한 저장 장치에 복사해두는 덤프를 이용
- 전체 DB의 내용을 다른 저장 장치에 복사하는 것은 비용이 많이 듦
- 복사하는 동안에는 트랜잭션 수행을 중단해야 하므로 CPU가 낭비됨

## 병행 제어
- 트랜잭션이 병행 수행될 때 트랜잭션이 데이터베이스의 일관성을 파괴하지 않고, 다른 트랜잭션에 영향을 주지 않도록 트랜잭션 간의 상호작용을 제어하는 것

### 목적
- 데이터베이스의 일관성 유지
- 데이터베이스 공유 최대화
- 시스템 활용도 최대화
- 사용자 응답 시간 최소화
- 단위 시간당 트랜잭션 처리 건수 최대화

### 병행 제어 기법
1. 로킹
- 트랜잭션이 접근하려는 데이터를 다른 트랜잭션이 접근하지 못하도록 잠그는 병행 제어 기법
2. 타임스탬프 순서 기법
- 타임스탬프 순서에 따라 트랜잭션들을 직렬화 시키는 방법
3. 낙관적 병행 제어
- 트랜잭션 수행 동안은 어떠한 검사를 하지 않고, 트랜잭션이 종료된 이후에 일괄적으로 검사하는 방식 
4. 다중 버전 병행 제어